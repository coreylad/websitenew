<?php
/*
 * @ https://EasyToYou.eu - IonCube v11 Decoder Online
 * @ PHP 7.2 & 7.3
 * @ Decoder version: 1.0.6
 * @ Release: 10/08/2022
 */

$TSSEConfig->TSLoadConfig("SHOUTBOX");
if (!$is_mod) {
    $query = sql_query("SELECT canshout FROM ts_u_perm WHERE $userid = " . sqlesc($CURUSER["id"]));
    if (0 < mysqli_num_rows($query)) {
        $shoutperm = mysqli_fetch_assoc($query);
        if ($shoutperm["canshout"] == "0") {
            $usergroups["canshout"] = "no";
        }
    }
}
$lang->load("shoutbox");
$GLOBALS["s_pc2perm"] = isset($GLOBALS["s_pc2perm"]) ? @explode(",", $GLOBALS["s_pc2perm"]) : [];
$GLOBALS["s_pc3perm"] = isset($GLOBALS["s_pc3perm"]) ? @explode(",", $GLOBALS["s_pc3perm"]) : [];
$GLOBALS["s_pc4perm"] = isset($GLOBALS["s_pc4perm"]) ? @explode(",", $GLOBALS["s_pc4perm"]) : [];
$GLOBALS["s_pc5perm"] = isset($GLOBALS["s_pc5perm"]) ? @explode(",", $GLOBALS["s_pc5perm"]) : [];
$Channels = "\r\n<select $name = \"channel\" $id = \"channel\">\r\n\t<optgroup $label = \"" . $lang->shoutbox["c"] . "\">\r\n\t\t<option $value = \"0\"" . (isset($_COOKIE["TS_LastShoutChannel"]) && $_COOKIE["TS_LastShoutChannel"] == "0" ? " $selected = \"selected\"" : "") . ">" . $lang->shoutbox["c1"] . "</option>\r\n\t\t" . (in_array($CURUSER["usergroup"], $GLOBALS["s_pc2perm"]) ? "<option $value = \"1\"" . (isset($_COOKIE["TS_LastShoutChannel"]) && $_COOKIE["TS_LastShoutChannel"] == "1" ? " $selected = \"selected\"" : "") . ">" . $lang->shoutbox["c2"] . "</option>" : "") . "\r\n\t\t" . (in_array($CURUSER["usergroup"], $GLOBALS["s_pc3perm"]) ? "<option $value = \"2\"" . (isset($_COOKIE["TS_LastShoutChannel"]) && $_COOKIE["TS_LastShoutChannel"] == "2" ? " $selected = \"selected\"" : "") . ">" . $lang->shoutbox["c3"] . "</option>" : "") . "\r\n\t\t" . (in_array($CURUSER["usergroup"], $GLOBALS["s_pc4perm"]) ? "<option $value = \"3\"" . (isset($_COOKIE["TS_LastShoutChannel"]) && $_COOKIE["TS_LastShoutChannel"] == "3" ? " $selected = \"selected\"" : "") . ">" . $lang->shoutbox["c4"] . "</option>" : "") . "\r\n\t\t" . (in_array($CURUSER["usergroup"], $GLOBALS["s_pc5perm"]) ? "<option $value = \"4\"" . (isset($_COOKIE["TS_LastShoutChannel"]) && $_COOKIE["TS_LastShoutChannel"] == "4" ? " $selected = \"selected\"" : "") . ">" . $lang->shoutbox["c5"] . "</option>" : "") . "\r\n\t</optgroup>\r\n</select>";
$shoutboxIsLoading = "<div class=\"fb-shoutbox-loading\"><img $src = \"" . $BASEURL . "/include/templates/" . $defaulttemplate . "/images/ajax_loading.gif\" $alt = \"\" $title = \"\" class=\"middle\" /> " . $lang->global["pleasewait"] . "</div>";
echo "\r\n<div $id = \"fb-shoutbox\">\r\n\t<div class=\"fb-shoutbox-head\">\r\n\t\t<span class=\"fb-shoutbox-channels\">" . $Channels . "</span>\r\n\t\t<span class=\"fb-shoutbox-settings\">\r\n\t\t\t<span class=\"fb-shoutbox-setings-html\">\r\n\t\t\t\t<span class=\"fb-shoutbox-see-online-list\">" . $lang->shoutbox["fb-shoutbox6"] . "</span>\r\n\t\t\t\t<span class=\"fb-shoutbox-autoscroll\">" . $lang->shoutbox["fb-shoutbox4"] . "</span>\r\n\t\t\t</span>\r\n\t\t</span>\r\n\t\t<span class=\"fb-shoutbox-timeout-message\"></span>\r\n\t\t<div class=\"fb-shoutbox-close-btn\">&nbsp;</div>\r\n\t</div>\r\n\t<div class=\"fb-shoutbox-toggle-chat\">\r\n\t\t<div class=\"fb-shoutbox-online-list\">" . $shoutboxIsLoading . "</div>\r\n\t\t" . ($GLOBALS["S_ANNOUNCEMENT"] ? "\r\n\t\t<div class=\"fb-shoutbox-annoucenement\">" . $GLOBALS["S_ANNOUNCEMENT"] . "</div>\r\n\t\t" : "") . "\r\n\t\t<div class=\"fb-shoutbox-message-box\">" . $shoutboxIsLoading . "</div>\r\n\t\t" . ($usergroups["canshout"] == "yes" ? "\r\n\t\t<div class=\"fb-shoutbox-post-shout\">\r\n\t\t\t<div class=\"fb-shoutbox-smilies-html\"></div>\r\n\t\t\t<div class=\"fb-shoutbox-smilies\"><img $src = \"" . $pic_base_url . "codebuttons/smilies.gif\" $alt = \"\" $title = \"\" /></div>\r\n\t\t\t<input $name = \"shout_message\" $id = \"shout_message\" $type = \"text\" $placeholder = \"" . $lang->shoutbox["fb-shoutbox3"] . "\" $maxlength = \"255\" />\r\n\t\t</div>" : "") . "\r\n\t</div>\r\n</div>\r\n<script $type = \"text/javascript\" $src = \"" . $BASEURL . "/scripts/jquery.cookie.js?$v = " . O_SCRIPT_VERSION . "\"></script>\r\n<script $type = \"text/javascript\">\r\n\tvar FBShoutboxCookie = jQuery.cookie(\"FBShoutboxCookie\"),Channel = 0,FBUpdateShoutbox, FBAutoScroll=1;\r\n\r\n\tfunction toggleAutoScroll()\r\n\t{\r\n\t\$tFBAutoScroll = FBAutoScroll == 1 ? 0 : 1;\r\n\t\tjQuery(\".fb-shoutbox-autoscroll\").html(FBAutoScroll ? \"" . $lang->shoutbox["fb-shoutbox4"] . "\" : \"" . $lang->shoutbox["fb-shoutbox5"] . "\");\r\n\t\ttimeoutMessage((FBAutoScroll ? \"" . $lang->shoutbox["fb-shoutbox8"] . "\" : \"" . $lang->shoutbox["fb-shoutbox7"] . "\"));\r\n\t}\r\n\r\n\tfunction scrollMessageBox()\r\n\t{\r\n\t\tif(FBAutoScroll)\r\n\t\t{\r\n\t\t\tjQuery(\".fb-shoutbox-message-box\").animate({ scrollTop: (parseInt(jQuery(\".fb-shoutbox-message-box\").prop(\"scrollHeight\"))+1450) }, 1000);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction fetchShouts(setFBUpdateShoutboxInterval, scrollToBottom)\r\n\t{\r\n\t\tjQuery.ajax\r\n\t\t({\r\n\t\t\tdata: \"FBShoutbox=1&$channel = \"+Channel,\r\n\t\t\ttype: \"POST\",\r\n\t\t\turl: baseurl+\"/ts_shoutbox/ts_update_shout.php\",\r\n\t\t\tcontentType: \"application/x-www-form-urlencoded; $charset = \"+charset,\r\n\t\t\tencoding: charset,\r\n\t\t\tcache: false,\r\n\t\t\ttimeout: 25000,\r\n\t\t\tsuccess: function(result)\r\n\t\t\t{\r\n\t\t\t\tif(result)\r\n\t\t\t\t{\r\n\t\t\t\t\tjQuery(\".fb-shoutbox-message-box\").html(result);\r\n\t\t\t\t\tif(scrollToBottom)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tscrollMessageBox();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(setFBUpdateShoutboxInterval)\r\n\t\t\t\t{\r\n\t\t\t\t\tenableFBUpdateShoutbox();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction disableFBUpdateShoutbox()\r\n\t{\r\n\t\tclearInterval(FBUpdateShoutbox);\r\n\t\$tFBUpdateShoutbox = false;\r\n\t}\r\n\r\n\tfunction enableFBUpdateShoutbox()\r\n\t{\r\n\t\$tFBUpdateShoutbox = window.setInterval(function()\r\n\t\t{\r\n\t\t\tfetchShouts(false, true);\r\n\t\t}, " . $GLOBALS["S_REFRESHTIME"] * 1000 . ");\r\n\t}\r\n\r\n\tfunction slimFocus(el)\r\n\t{\r\n\t\$tel = jQuery(el), $tempVal = el.val();\r\n\t\tel.focus().val(\"\");\r\n\t\tel.val(tempVal);\r\n\t\tel.attr(\"disabled\", false);\r\n\t}\r\n\r\n\tfunction PrivateShout(Username)\r\n\t{\r\n\t\tif (Username)\r\n\t\t{\r\n\t\t\tjQuery(\"#shout_message\").val(\"/private \"+Username+\" \");\r\n\t\t\tslimFocus(\"#shout_message\");\r\n\t\t}\r\n\t}\r\n\r\n\tfunction timeoutMessage(msg)\r\n\t{\r\n\t\tjQuery(\".fb-shoutbox-timeout-message\").hide().empty().html(msg).fadeIn();\r\n\t\tsetTimeout(function(){jQuery(\".fb-shoutbox-timeout-message\").fadeOut();}, 4000);\r\n\t}\r\n\r\n\tif(jQuery.cookie(\"TS_LastShoutChannel\"))\r\n\t{\r\n\t\tvar TMPChannel = parseInt(jQuery.cookie(\"TS_LastShoutChannel\"));\r\n\t\tif (TMPChannel)\r\n\t\t{\r\n\t\t\$tChannel = TMPChannel;\r\n\t\t}\r\n\t}\r\n\r\n\tjQuery(document).on(\"click\", \".fb-shoutbox-autoscroll\", function(e)\r\n\t{\r\n\t\te.preventDefault();\r\n\t\ttoggleAutoScroll();\r\n\t\tjQuery(\".fb-shoutbox-setings-html\").toggle();\r\n\t\treturn false;\r\n\t});\r\n\r\n\tjQuery(document).on(\"click\", \".fb-shoutbox-settings\", function(e)\r\n\t{\r\n\t\te.preventDefault();\r\n\t\tjQuery(\".fb-shoutbox-setings-html\").toggle();\r\n\t\treturn false;\r\n\t});\r\n\r\n\tjQuery(document).on(\"click\", \".fb-shoutbox-see-online-list\", function(e)\r\n\t{\r\n\t\te.preventDefault();\r\n\r\n\t\tjQuery(\".fb-shoutbox-setings-html\").toggle();\r\n\r\n\t\tjQuery(\".fb-shoutbox-smilies-html\").hide();\r\n\t\tjQuery(\".fb-shoutbox-online-list\").toggle();\r\n\r\n\t\tif(jQuery(\".fb-shoutbox-online-list\").css(\"display\") == \"block\")\r\n\t\t{\r\n\t\t\tjQuery(\".fb-shoutbox-online-list\").html('" . $shoutboxIsLoading . "').show();\r\n\t\t\tjQuery.post(\"" . $BASEURL . "/fb-shoutbox-members-in-chat.php\", function(response)\r\n\t\t\t{\r\n\t\t\t\tjQuery(\".fb-shoutbox-online-list\").html('<div class=\"fb-shoutbox-online-list-response\">'+response+'</div>');\r\n\t\t\t\t\r\n\t\t\t\tjQuery(\".fb-shoutbox-online-list\").animate({height: jQuery(\"#fb-shoutbox\").height()});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t});\r\n\r\n\tjQuery(document).on(\"click\", \".fb-shoutbox-smilies\", function(e)\r\n\t{\r\n\t\te.preventDefault();\r\n\r\n\t\tjQuery(\".fb-shoutbox-smilies-html\").toggle();\r\n\t\tjQuery(\".fb-shoutbox-online-list\").hide();\r\n\r\n\t\tif(jQuery(\".fb-shoutbox-smilies-html\").css(\"display\") == \"block\" && !jQuery(\".fb-shoutbox-smilies-html\").html())\r\n\t\t{\r\n\t\t\tjQuery.get(\"" . $BASEURL . "/fb-shoutbox-load-smilies.php\", function(response)\r\n\t\t\t{\r\n\t\t\t\tjQuery(\".fb-shoutbox-smilies-html\").html('<div class=\"fb-shoutbox-smilies-response\">'+response+'</div>');\r\n\r\n\t\t\t\tjQuery(\".fb-shoutbox-smilies-response\").on(\"click\", \"img\", function(e)\r\n\t\t\t\t{\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tjQuery(\"#shout_message\").val(jQuery(\"#shout_message\").val()+\" \"+jQuery(this).data(\"code\"));\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t});\r\n\r\n\tjQuery(document).on(\"change\", \"#channel\", function(e)\r\n\t{\r\n\t\tdisableFBUpdateShoutbox();\r\n\t\$tChannel = parseInt(jQuery(this).val());\r\n\t\tjQuery.cookie(\"TS_LastShoutChannel\", Channel);\r\n\t\tfetchShouts(true, true);\r\n\t});\r\n\r\n\tif(FBShoutboxCookie && FBShoutboxCookie == \"toggle\")\r\n\t{\r\n\t\tjQuery(\"#channel,.fb-shoutbox-settings\").hide();\r\n\t\tjQuery(\".fb-shoutbox-toggle-chat\").hide();\r\n\t\tjQuery(\".fb-shoutbox-head div\").attr(\"class\", \"fb-shoutbox-open-btn\");\r\n\t\tjQuery(\"#fb-shoutbox\").fadeTo(\"fast\",0.7);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tfetchShouts(true, true);\r\n\t}\r\n\r\n\tjQuery(\".fb-shoutbox-close-btn,.fb-shoutbox-open-btn\").click(function(e)\r\n\t{\r\n\t\te.preventDefault();\r\n\r\n\t\tvar $toggleState = jQuery(\".fb-shoutbox-toggle-chat\").css(\"display\");\r\n\r\n\t\tjQuery(\".fb-shoutbox-toggle-chat\").slideToggle();\r\n\r\n\t\tif($toggleState = = \"block\")\r\n\t\t{\r\n\t\t\tjQuery(\"#channel,.fb-shoutbox-settings\").hide();\r\n\t\t\tjQuery(\".fb-shoutbox-head div\").attr(\"class\", \"fb-shoutbox-open-btn\");\r\n\t\t\tjQuery.cookie(\"FBShoutboxCookie\", \"toggle\");\r\n\t\t\tdisableFBUpdateShoutbox();\r\n\t\t\tjQuery(\"#fb-shoutbox\").fadeTo(\"fast\", 0.7);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tjQuery(\"#channel,.fb-shoutbox-settings\").show();\r\n\t\t\tjQuery(\".fb-shoutbox-head div\").attr(\"class\", \"fb-shoutbox-close-btn\");\r\n\t\t\tjQuery.cookie(\"FBShoutboxCookie\", \"open\");\r\n\t\t\tfetchShouts(true);\r\n\t\t\tjQuery(\"#fb-shoutbox\").fadeTo(\"fast\",1);\r\n\t\t\tscrollMessageBox();\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t});\r\n\r\n\t" . ($usergroups["canshout"] == "yes" ? "\r\n\tjQuery(\"#shout_message\").keypress(function(evt)\r\n\t{\r\n\t\tif(evt.$which = = 13)\r\n\t\t{\r\n\t\t\tdisableFBUpdateShoutbox();\r\n\r\n\t\t\tjQuery(\"#shout_message\").attr(\"disabled\", true);\r\n\r\n\t\t\tvar $imessage = jQuery(\"#shout_message\").val(), $pars = \"uid=" . intval($CURUSER["id"]) . "&$channel = \"+Channel+\"&$shout = \"+urlencode(imessage);\r\n\r\n\t\t\tjQuery.ajax\r\n\t\t\t({\r\n\t\t\t\tdata: pars,\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\turl: baseurl+\"/ts_shoutbox/ts_post_shout.php\",\r\n\t\t\t\tcontentType: \"application/x-www-form-urlencoded; $charset = \"+charset,\r\n\t\t\t\tencoding: charset,\r\n\t\t\t\tcache: false,\r\n\t\t\t\ttimeout: 25000,\r\n\t\t\t\tsuccess: function(result)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(result)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\talert(result);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tjQuery(\"#shout_message\").val(\"\");\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tslimFocus(\"#shout_message\");\r\n\t\t\t\t\tfetchShouts(true, true);\r\n\t\t\t\t}\r\n\r\n\t\t\t}).fail(function(err)\r\n\t\t\t{ \r\n\t\t\t\t//alert HTTP server error\r\n\t\t\t\talert(err.statusText); \r\n\t\t\t\tslimFocus(\"#shout_message\");\r\n\t\t\t});\r\n\t\t}\r\n\t});" : "") . "\r\n\r\n\t" . ($is_mod || $GLOBALS["S_CANDELETE"] == "yes" ? "\r\n\tfunction DeleteShout(ShoutID)\r\n\t{\r\n\t\tif (!confirm(\"" . $lang->shoutbox["sure"] . "\"))\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tdisableFBUpdateShoutbox();\r\n\t\t\r\n\t\tvar $pars = \"uid=" . intval($CURUSER["id"]) . "&$channel = \"+Channel+\"&$sid = \"+ShoutID;\r\n\r\n\t\tjQuery.ajax\r\n\t\t({\r\n\t\t\tdata: pars,\r\n\t\t\ttype: \"POST\",\r\n\t\t\turl: baseurl+\"/ts_shoutbox/ts_delete_shout.php\",\r\n\t\t\tcontentType: \"application/x-www-form-urlencoded; $charset = \"+charset,\r\n\t\t\tencoding: charset,\r\n\t\t\tcache: false,\r\n\t\t\ttimeout: 25000,\r\n\t\t\tsuccess: function(response)\r\n\t\t\t{\r\n\t\t\t\tif ($response = = \"DELETED\")\r\n\t\t\t\t{\r\n\t\t\t\t\tjQuery(\"#shout_\"+ShoutID).html('<div $style = \"color: #fff; background: red; border: 1px solid #000; text-align: center;\">" . $lang->shoutbox["deleted"] . "</div>');\r\n\t\t\t\t}\r\n\t\t\t\tfetchShouts(true, true);\r\n\t\t\t}\r\n\t\t});\r\n\t}" : "") . "\r\n\r\n\t" . ($is_mod || $GLOBALS["S_CANEDIT"] == "yes" ? "\r\n\tfunction EditShout(ShoutID)\r\n\t{\r\n\t\tvar $selectedShout = jQuery(\"#shout_msg_\"+ShoutID), $currentShout = selectedShout.html();\t\r\n\t\tvar $pars = \"channel=\"+Channel+\"&$sid = \"+ShoutID;\r\n\r\n\t\tdisableFBUpdateShoutbox();\r\n\r\n\t\tjQuery.ajax\r\n\t\t({\r\n\t\t\tdata: pars,\r\n\t\t\ttype: \"POST\",\r\n\t\t\turl: baseurl+\"/ts_shoutbox/ts_get_shout.php\",\r\n\t\t\tcontentType: \"application/x-www-form-urlencoded; $charset = \"+charset,\r\n\t\t\tencoding: charset,\r\n\t\t\tcache: false,\r\n\t\t\ttimeout: 25000,\r\n\t\t\tsuccess: function(response)\r\n\t\t\t{\r\n\t\t\t\tselectedShout.html('<form $name = \"fb-shoutbox-edit-shout-save-'+ShoutID+'\"><input $type = \"hidden\" $name = \"uid\" $value = \"" . intval($CURUSER["id"]) . "\" /><input $type = \"hidden\" $name = \"channel\" $value = \"'+Channel+'\" /><input $type = \"hidden\" $name = \"sid\" $value = \"'+ShoutID+'\" /><input $type = \"hidden\" $name = \"channel\" $value = \"'+Channel+'\" /> <textarea $name = \"newshout\">'+response+'</textarea> <input $type = \"submit\" $value = \"" . $lang->global["buttonsave"] . "\" /> <input $type = \"button\" $name = \"cancel\" $value = \"" . $lang->global["cancel"] . "\" $onclick = \"fetchShouts(true, true);\" /></form>');\r\n\t\t\t\tjQuery('form[$name = \"fb-shoutbox-edit-shout-save-'+ShoutID+'\"]').submit(function(e)\r\n\t\t\t\t{\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar $formFields = jQuery(this).serialize();\r\n\r\n\t\t\t\t\tjQuery.ajax\r\n\t\t\t\t\t({\r\n\t\t\t\t\t\tdata: formFields,\r\n\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\turl: baseurl+\"/ts_shoutbox/ts_save_shout.php\",\r\n\t\t\t\t\t\tcontentType: \"application/x-www-form-urlencoded; $charset = \"+charset,\r\n\t\t\t\t\t\tencoding: charset,\r\n\t\t\t\t\t\tcache: false,\r\n\t\t\t\t\t\ttimeout: 25000,\r\n\t\t\t\t\t\tsuccess: function(response)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif(response)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tselectedShout.html(response);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tselectedShout.html(currentShout);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tfetchShouts(true, true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}" : "") . "\r\n</script>";

?>